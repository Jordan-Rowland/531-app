<!DOCTYPE html>
<html lang="en">

<head>
    <!-- <script defer src="alpine.js"></script> -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.ico" type="image/png">
    <title>531 Calculator</title>
    <link rel="stylesheet" type="text/css" href="app.css">
    <script src="app.js"></script>
</head>

<body>
    <div x-data="workoutBuilder" class="main">
        </template>
        <label for="tm">Training Max:</label>
        <input id="tm" type="number" x-model="tm" placeholder="">
        <div id="options">
            <label for="jokers">Jokers</label>
            <input id="jokers" x-model="jokers" type="checkbox">
            <label for="threeFiveOne">351</label>
            <input id="threeFiveOne" x-model="threeFiveOne" type="checkbox">
            <label for="fivePros">5-PROs</label>
            <input id="fivePros" x-model="fivePros" type="checkbox">
            <label for="roundTo">Round to</label>
            <select id="roundTo" x-model="roundTo" type="number">
                <option value="2.5">2.5</option>
                <option value="5">5</option>
            </select>
            <select id="supplemental" x-model="supplemental">
                <option value="fsl">FSL</option>
                <option value="ssl">SSL</option>
            </select>
        </div>
        <template x-for="(workout, index) in workouts" :key="workout.id"
            x-init="$watch('tm, threeFiveOne, fivePros, jokers, roundTo, supplemental', () => {generateMainWork()})">
            <div x-show="tm > 0" class="card">
                <template x-if="index === 0">
                    <h4 x-text="`Warm Up: `"></h4>
                </template>
                <template x-if="index > 0">
                    <h4 x-text="`Workout ${index}: `"></h4>
                </template>
                <template x-for="(percentage, index) in workout.percentages.slice(0, jokers ? 6 : 3)">
                    <ul x-data="workoutRow(percentage)">
                        <li @click="showPlates = !showPlates" :class="showPlates && 'open'">
                            <span x-text="`${percentageAndWeight()} / ${workout.reps[index]}`"></span>
                            <div x-show="showPlates">
                                <div><b>Plates per side:</b></div>
                                <div x-html="calculatePlates(roundWeight(tm * percentage))"></div>
                            </div>
                        </li>
                    </ul>
                </template>
                <template x-if="index != 0">
                    <div class="supplemental-block" x-data="{
                    ...supplementalComponent(workout),
                    open: false,
                    supplemental_: supplemental,
                }"
                x-init="$watch('supplemental, tm', (value) => setsupplementalState(value))">
                        <!-- Maybe move the below data into component ?? -->
                        <!--
                            I think this is not working because the data below gets set(calculated) the first time it runs
                            and is not getting re-calculated afterwards. Need methods, I think

                            ^-- first tests here don't work, because it is still getting calc'd on render...
                        -->
                        <div x-init="setsupplementalState(supplemental_)" @click="open = !open">
                            <div><b>Supplemental: <span x-text="label"></span></b></div>
                            <div x-text="`${percentage}% - ${weight}lbs / 5x5`"></div>
                            <div x-show="open"><b>Plates per side:</b></div>
                            <div x-show="open" x-html="calculatePlates(weight)"></div>
                        </div>
                </template>
            </div>
    </div>
    </template>
    </div>

</body>

</html>